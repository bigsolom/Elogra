<script type="text/javascript">
    var moreActionURL = "<?= $this->url(array('controller' => 'hakawy', 'action' => 'more'), 'default', true) ?>";
    var noMoreMsg = "<?=  Application_Service_Translate::_('no_more_results')?>";
    var reportURL = "<?=$this->url(array('controller'=>'ajax','action'=>'report'),'default',true)?>";
    var reportMsg = "<?=  Application_Service_Translate::_('report_success_msg')?>";
    function addHekaya(){
           if($("#taxiTalksInput").val() == ''){
                $("#alert-area").append($("<div id=\"error-alert\" class=\"alert alert-error\"><a class=\"close\" data-dismiss=\"alert\">×</a> <strong>أحكى حكايتك</strong></div> "));
                $("#error-alert").delay(2000).fadeOut("slow", function () { $(this).remove(); });                
                return false;
            }
           $.ajax({
                url: "<?= $this->url(array('controller' => 'hakawy', 'action' => 'submit'), 'default', true) ?>",
                dataType: "json", 
                data: $('#hekayaForm').serialize(),
                beforeSend:function(){ //disable button and field
                   $('#taxiTalksInput').attr("disabled","disabled");
                   $('#hekayaButton').attr("disabled","disabled");
                },
                complete: function(){//enable them back
                    $('#taxiTalksInput').attr("value","");
                    displayCharCounts(document.getElementById("taxiTalksInput"));//to reset the characters counter
                    $('#taxiTalksInput').removeAttr("disabled");
                    $('#hekayaButton').removeAttr("disabled");
                },
                success: function(data) {
                    $(".container").prepend(data.html);
                }
             });
             $("#alert-area").append($("<div id=\"error-alert\" class=\"alert alert-success\"><a class=\"close\" data-dismiss=\"alert\">×</a> <strong>شكرا على الحدوته</strong></div> "));
             $("#error-alert").delay(2000).fadeOut("slow", function () { $(this).remove(); });
        }
</script>
<script type="text/javascript" src="/js/pagination.js"></script>
<div id="alert-area"></div>
<form id="hekayaForm" method="post" onsubmit="addHekaya(); return false;" class="well hekaya-border">
    <fieldset>
<textarea class="expand" 
id="taxiTalksInput" name="taxiTalksInput" maxlength="500"  onfocus="OnFocusInput(this)" onblur="OnBlurInput(this)" placeholder="قول للناس حدوتك"></textarea>
    <input type="submit" name="button" id="hekayaButton" value="<?=  Application_Service_Translate::_('share')?>" class="add-hekaya-btn" />
	 </fieldset>
</form>
<script type="text/javascript" src="/js/charcount.js"></script>

 <section class="paginated round-box-border" id="scrlDiv" data-page="1" data-status="idle">
    <?php
    foreach ($this->hakawy as $hekaya) {
        ?>
            <?= $this->partial('partials/_hekaya.phtml', array('hekaya' => $hekaya)); ?>
            
        <?php
    }
    ?>
       
</section>
